<!-- Cluster Analysis Example Slides -->

<!-- Slide 1: Section Title -->
<section class="section-slide">
  <h2>Cluster Analysis Example</h2>
</section>

<!-- Slide 2: Our Data -->
<section>
  <h2>Our Data</h2>
  <p style="font-size: 0.9em;">Kaggle Dataset: Injury Prediction for Competitive Runners</p>

  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 20px; margin: 20px 0;">
    <h3 style="margin-top: 0;">Dataset Details</h3>
    <ul style="text-align: left; font-size: 0.85em;">
      <li><strong>Source:</strong> <a href="https://www.kaggle.com/datasets/shashwatwork/injury-prediction-for-competitive-runners" target="_blank">kaggle.com/datasets/shashwatwork/injury-prediction-for-competitive-runners</a></li>
      <li><strong>Unit of Analysis:</strong> Training per week per athlete</li>
      <li><strong>Variables:</strong> Training load, distance, intensity, recovery metrics</li>
      <li><strong>Goal:</strong> Cluster athletes by training patterns</li>
    </ul>
  </div>

  <p style="font-size: 0.85em; color: #666; margin-top: 20px;">
    We'll aggregate athlete data by mean values to identify typical training profiles
  </p>
</section>

<!-- Slide 3: What Could We Cluster? -->
<section>
  <h2>What Could We Cluster?</h2>

  <div class="two-columns" style="margin-top: 30px;">
    <div class="column">
      <h3 style="color: #2196f3;">Option 1: Typical Training Weeks</h3>
      <ul style="font-size: 0.85em; text-align: left;">
        <li>Each week as a data point</li>
        <li>Identify patterns: base training, peak training, taper weeks</li>
        <li>High temporal granularity</li>
      </ul>
    </div>

    <div class="column">
      <h3 style="color: #2ecc71;">Option 2: Athletes</h3>
      <ul style="font-size: 0.85em; text-align: left;">
        <li>Each athlete as a data point</li>
        <li>Aggregate weekly data by mean</li>
        <li>Identify athlete training profiles</li>
        <li><strong>‚Üê We'll focus on this</strong></li>
      </ul>
    </div>
  </div>

  <div style="margin-top: 30px; padding: 15px; background: #fff3cd; border-radius: 8px;">
    <p style="margin: 0; font-size: 0.9em; color: #856404;">
      üí° <strong>Why Athletes?</strong> More interpretable for coaching decisions and personalized training plans
    </p>
  </div>
</section>

<!-- Slide 4: Interactive Cluster Analysis with R -->
<section class="interactive-slide">
  <h2>Interactive Cluster Analysis with R</h2>
  <p style="font-size: 0.9em;">Live analysis using webR (R running in your browser via WebAssembly)</p>
  <p style="font-size: 0.85em; color: #666;">Based on Kaggle's <strong>Injury Prediction for Competitive Runners</strong> dataset</p>

  <div id="webr-cluster-analysis" style="width: 100%; min-height: 700px;"></div>

  <p style="font-size: 0.75em; color: #666; margin-top: 20px;">
    <em>Note: First load may take 1-2 minutes while R packages install</em>
  </p>
</section>

<!-- Slide 5: Try It Yourself: Edit and Run R Code -->
<section class="interactive-slide">
  <h2>Try It Yourself: Perform Cluster Analysis</h2>
  <p style="font-size: 0.9em;">The injury prediction data is loaded. Add your own cluster analysis code and click <strong>Run</strong></p>

  <div id="webr-cluster-editor" style="width: 100%; height: 600px; margin-top: 20px;"></div>

  <p style="font-size: 0.75em; color: #666; margin-top: 15px;">
    <em>üí° Tasks: Explore the data ‚Üí Select numeric variables ‚Üí Normalize ‚Üí Run k-means ‚Üí Visualize results</em>
  </p>
</section>

<!-- Slide 6: Data Preparation -->
<section>
  <h2>Data Preparation</h2>

  <div style="background: #f5f5f5; border-radius: 8px; padding: 20px; margin: 20px 0; font-family: 'Courier New', monospace; font-size: 0.85em; text-align: left;">
    <pre style="margin: 0;"><code># Load training time series data
training_timeseries <- read_csv("week_approach_maskedID_timeseries.csv")

# Aggregate by athlete (compute mean across all weeks)
athlete_data_means <- aggregate(. ~ `Athlete ID`,
                                 training_timeseries,
                                 mean)

# Result: Each athlete represented by average training metrics</code></pre>
  </div>

  <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
    <p style="margin: 0; font-size: 0.9em; color: #1565c0;">
      üìä This transforms weekly observations into athlete-level profiles
    </p>
  </div>
</section>

<!-- Slide 7: Which Variables to Use? -->
<section>
  <h2>Which Variables to Use?</h2>

  <div style="text-align: left; margin: 20px 0;">
    <h3 style="color: #2196f3;">Exploratory Data Analysis First!</h3>

    <div style="background: #f5f5f5; border-radius: 8px; padding: 15px; margin: 15px 0; font-family: 'Courier New', monospace; font-size: 0.8em;">
      <pre style="margin: 0;"><code># Summary statistics
summary(athlete_data_means)

# Correlation analysis
pairs(athlete_data_means[, -1])  # Exclude ID column</code></pre>
    </div>

    <h4 style="margin-top: 20px;">Key Questions:</h4>
    <ul style="font-size: 0.85em;">
      <li>What variables exist in the dataset?</li>
      <li>What are the distributions, means, standard deviations?</li>
      <li>Are variables significantly correlated?</li>
      <li>Should we remove highly correlated features?</li>
    </ul>
  </div>
</section>

<!-- Slide 8: Normalization -->
<section>
  <h2>Normalization</h2>

  <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0;">
    <h3 style="margin-top: 0; color: #856404;">Why Normalize?</h3>
    <p style="margin: 10px 0; font-size: 0.9em;">
      If variables are not at the same scale, features with larger ranges will dominate distance calculations
    </p>
  </div>

  <div class="two-columns" style="margin-top: 30px;">
    <div class="column">
      <h4 style="color: #2196f3;">Min-Max Normalization [0,1]</h4>
      <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.75em;">
        <pre style="margin: 0;"><code>x_norm = (x - min) / (max - min)</code></pre>
      </div>
      <p style="font-size: 0.8em; margin-top: 10px;">Good for bounded ranges</p>
    </div>

    <div class="column">
      <h4 style="color: #2ecc71;">Z-score Standardization</h4>
      <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.75em;">
        <pre style="margin: 0;"><code>z = (x - mean) / sd
z <- scale(mydata)</code></pre>
      </div>
      <p style="font-size: 0.8em; margin-top: 10px;">Better with outliers</p>
    </div>
  </div>
</section>

<!-- Slide 9: Hierarchical Clustering -->
<section>
  <h2>Hierarchical Clustering</h2>

  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 20px; margin: 20px 0;">
    <h3 style="margin-top: 0;">Agglomerative Approach</h3>
    <ol style="text-align: left; margin-left: 20px; font-size: 0.9em;">
      <li>Start with each data point as its own cluster</li>
      <li>Merge the two closest clusters</li>
      <li>Repeat until all points are in one cluster</li>
      <li>Visualize with dendrogram to choose cut height</li>
    </ol>
  </div>

  <div style="background: #f5f5f5; border-radius: 8px; padding: 15px; margin: 15px 0; font-family: 'Courier New', monospace; font-size: 0.8em; text-align: left;">
    <pre style="margin: 0;"><code># Calculate distance matrix
distance <- dist(normalized_data)

# Hierarchical agglomerative clustering
mydata.hclust <- hclust(distance, method = "ward.D2")

# Plot dendrogram
plot(mydata.hclust)</code></pre>
  </div>
</section>

<!-- Slide 10: K-means Clustering -->
<section>
  <h2>K-means Clustering</h2>

  <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 20px; margin: 20px 0;">
    <h3 style="margin-top: 0;">Algorithm Steps</h3>
    <ol style="text-align: left; margin-left: 20px; font-size: 0.9em;">
      <li>Pick K centroids (initial cluster centers)</li>
      <li>Assign each data point to its closest centroid</li>
      <li>Move centroids to the mean of assigned points</li>
      <li>Repeat steps 2 & 3 until centroids stabilize</li>
    </ol>
  </div>

  <div style="background: #f5f5f5; border-radius: 8px; padding: 15px; margin: 15px 0; font-family: 'Courier New', monospace; font-size: 0.8em; text-align: left;">
    <pre style="margin: 0;"><code># K-means clustering
set.seed(123)  # For reproducibility
kmeans_result <- kmeans(normalized_data, centers = 3, nstart = 25)

# Examine results
kmeans_result$cluster
kmeans_result$centers</code></pre>
  </div>
</section>

<!-- Slide 11: Determining Optimal K -->
<section>
  <h2>How Many Clusters?</h2>

  <div style="background: #ffebee; border-left: 4px solid #f44336; padding: 20px; margin: 20px 0;">
    <h3 style="margin-top: 0; color: #c62828;">‚ö†Ô∏è Elbow Method (Intuitive but Flawed)</h3>
    <ul style="text-align: left; font-size: 0.85em;">
      <li>Plot within-cluster sum of squares vs. K</li>
      <li>Look for "elbow" where improvement slows</li>
      <li><strong>Problem:</strong> Mathematically not rigorous</li>
    </ul>
  </div>

  <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; margin: 20px 0;">
    <h3 style="margin-top: 0; color: #2e7d32;">‚úì Better Methods</h3>
    <ul style="text-align: left; font-size: 0.85em;">
      <li><strong>Gap Statistic:</strong> Compares within-cluster variation to null reference</li>
      <li><strong>Average Silhouette Width (ASW):</strong> Measures how well points fit their clusters</li>
      <li>Both provide statistical justification for K</li>
    </ul>
  </div>
</section>
